!function(root,factory){"function"==typeof define&&define.amd?define([],factory):"object"==typeof exports?module.exports=factory():root.EasyQueryMaker=factory()}(this,(function(){"use strict";const cssClass=function(){return{MAIN_CLASS:"easy-query-maker",GROUP_CONTAINER:"rules-group-container",GROUP_HEADER:"rules-group-header",GROUP_BODY:"rules-group-body",RECORD_LIST:"rules-list",WRAP_BUTTONS:"buttons-header",WRAP_RADIOS:"radio-group OSFillParent",WRAP_INPUTS:"rule",RADIO_CONTAINER:"ThemeGrid_Width2",THEMEGRID_6:"ThemeGrid_Width6"}};let generateGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(c){var r=16*Math.random()|0,v;return("x"==c?r:3&r|8).toString(16)}))},inputs=[];inputs.SelectColumns=function(){let self=this,_get;return{get:function(){let options=_fields.get();return inputs.selectElementGeneric(options,self,"setColumn")}}},inputs.SelectOperators=function(){let self=this,_get;return{get:function(){let options=_operators.get();return inputs.selectElementGeneric(options,self,"setOperator")}}},inputs.selectElementGeneric=function(options,context,method){let $select=$("<select>",{class:"dropdown-display dropdown"});for(let option of options){let element=$("<option>",{value:option.value,text:option.name});$select.append(element)}$select.change(()=>{let value=$select[0].selectedOptions[0].value;context[method](value)}),context[method]($select[0].selectedOptions[0].value);let $div=new DivElement("","dropdown-container wrap-input");return $div.setIntoDiv($select),$div.setAttr("data-dropdown"),$div.getDiv()},inputs.InputText=function(){let self=this,_get;return{get:function(){let $inputText=$("<input>",{id:"",type:"text",class:"form-control","data-input":""});self.setValue($inputText[0].value),$inputText.change(()=>{let value=$inputText[0].value;self.setValue(value)});let $div=new DivElement("","wrap-input");return $div.setIntoDiv($inputText),$div.getDiv()}}},inputs.InputRadio=function(){let self=this,_get;return{get:function(){let radioId1=generateGuid(),radioId2=generateGuid(),$labelAnd=$("<label>",{for:radioId1,text:"AND"}),$labelOr=$("<label>",{for:radioId2,text:"OR"}),$inputRadio1=$("<input>",{type:"radio",class:"radio-button",value:"AND",name:self.id,id:radioId1}),$inputRadio2=$("<input>",{type:"radio",class:"radio-button",value:"OR",name:self.id,id:radioId2});$inputRadio1.click(e=>{self.setCondition(e.currentTarget.value)}),$inputRadio2.click(e=>{self.setCondition(e.currentTarget.value)}),"AND"===self.condition?$($inputRadio1).attr("checked",!0):$($inputRadio2).attr("checked",!0);let $groupRadio=new DivElement("","radio-group OSFillParent"),radio1=new DivElement("","ThemeGrid_Width2");radio1.setIntoDiv($inputRadio1,$labelAnd),radio1.setAttr("data-radio-button");let radio2=new DivElement("","ThemeGrid_Width2");radio2.setIntoDiv($inputRadio2,$labelOr),radio2.setAttr("data-radio-button"),$groupRadio.setIntoDiv(radio1.getDiv(),radio2.getDiv()),$groupRadio.setAttr("data-radio-group");let $divWrapper=new DivElement("","ThemeGrid_Width6");return $divWrapper.setIntoDiv($groupRadio.getDiv()),void 0!==self.value&&$inputText.val(self.operator),$divWrapper.getDiv()}}};let buttomMethods=[];buttomMethods.DeleteRule=function(){let $buttom=$("<button>",{class:"btn btn-delete ThemeGrid_MarginGutter",type:"button",text:"Delete"});return $buttom.click(()=>{this.removeRule()}),$buttom},buttomMethods.DeleteGroup=function(){let $buttom=$("<button>",{class:"btn btn-delete ThemeGrid_MarginGutter",type:"button",text:"Delete"});return $buttom.click(()=>{this.removeGroup()}),$buttom},buttomMethods.AddRule=function(){let $buttom=$("<button>",{class:"btn btn-success ThemeGrid_MarginGutter",type:"button",text:"Add Rule"});return $buttom.click(()=>{let newInstance=new Rule(generateGuid());this.addRuleToScreen(newInstance)}),$buttom},buttomMethods.AddGroup=function(){let $buttom=$("<button>",{class:"btn btn-success ThemeGrid_MarginGutter",type:"button",text:"Add Group"});return $buttom.click(()=>{this.addRuleToScreen(new GroupRules("AND"))}),$buttom};class Rule{constructor(Field,Column,Operator,Value){this.id=generateGuid(),this.column=Column,this.operator=Operator,this.value=Value}getHTML(){if(1==this.DELETE)return"";let divBody=new DivElement(this.id,"rule");return divBody.setIntoDiv(this.inputColumns().get(),this.inputOperators().get(),this.inputText().get(),this.buttomDeleteRule()),divBody.getDiv()}removeRule(){$("#"+this.id).remove(),Object.assign(this,new Rule),this.DELETE=!0}setColumn(value){this.column=value}setOperator(value){this.operator=value}setValue(value){this.value=value}}class GroupRules{constructor(Condition){this.id=generateGuid(),this.condition=Condition,this.rules=[],this.divWrapper=new DivElement(this.id,"rules-group-container"),this.divBody=new DivElement(this.id,"rules-group-body"),this.divList=new DivElement(this.id,"rules-list"),this.divHeader=new DivElement(this.id,"rules-group-header"),this.addRule(new Rule)}addRule(Rule){this.rules.push(Rule)}addRuleToScreen(Rule){this.addRule(Rule);let record=Rule.getHTML();this.divList.setIntoDiv(record),$(this.divList.getDiv()).append(record),this.divBody.setIntoDiv(this.divList.getDiv())}getHTML(isFirstTime){let wrapButtons=new DivElement("","buttons-header");return wrapButtons.setIntoDiv(this.buttomAddGroup(),this.buttomAddRule(),void 0===isFirstTime?this.buttomDeleteGroup():""),wrapButtons.setStyle({"text-align":"right","margin-left":"0px"}),this.divHeader.setIntoDiv(this.inputRadio().get(),wrapButtons.getDiv()),this.divWrapper.setIntoDiv(this.divHeader.getDiv(),this.divBody.getDiv()),this.divWrapper.getDiv()}getAllHTML(isFirstTime){1==isFirstTime&&this.getHTML(isFirstTime);let _rules=this.rules;for(let i=0;i<_rules.length;i++){let element=_rules[i];if(element instanceof Rule)this.divList.setIntoDiv(element.getHTML("","rules-group-body")),this.divBody.setIntoDiv(this.divList.getDiv());else{var ret=new DivElement;this.divList.setIntoDiv(element.getHTML()),this.divBody.setIntoDiv(this.divList.getDiv())}}return this.divWrapper.setIntoDiv(this.divBody.getDiv()),this.divWrapper.getDiv()}removeGroup(){$(this.divWrapper.getDiv()).remove(),Object.assign(this,new GroupRules),this.DELETE=!0}setCondition(value){this.condition=value}}class DivElement{constructor(Id,Class){this.DIV=$("<div>",{id:Id,class:Class})}setIntoDiv(){var args;Array.prototype.slice.call(arguments).forEach(element=>{this.DIV.append(element)})}getDiv(){return this.DIV}setAttr(value){$(this.DIV).attr(value,"")}setStyle(style){$(this.DIV).css(style)}}class Operator{constructor(name,value,expression){this.name=name,this.value=value,this.expression=expression}get(){return{name:this.name,value:this.value,expression:this.expression}}}class OperatorList{constructor(){this.operatorsList=[]}set(value){if(!value instanceof Operator)throw"The obkect instance is not valid";this.operatorsList.push(value)}setList(list){for(let item of list)this.operatorsList.push(new Operator(item.name,item.value,item.expression))}get(){return 0===this.operatorsList.length&&(this.operatorsList=defaultData.operators()),this.operatorsList}getById(Id){return this.operatorsList.find(x=>String(x.value)===Id)}}class Column{constructor(name,value,dataType){if(this.name=name,this.value=value,this.dataType=dataType,void 0===DataType()[this.dataType])throw"Datatype is not defined"}get(){return{name:this.name,value:this.value,dataType:this.dataType}}}class ColumnList{constructor(){this.fields=[]}set(value){if(!value instanceof Column)throw"The obkect instance is not valid";this.fields.push(value)}setList(list){for(let item of list)this.fields.push(new Column(item.name,item.value,item.dataType))}setJsonList(Json){this.setList(JSON.parse(Json))}get(){return 0===this.fields.length&&(this.fields=defaultData.columns()),this.fields}getById(Id){return this.fields.find(x=>String(x.value)===Id)}}class Main{constructor(){this.ruleset=[]}init(containerId){initializePrototypes(),this.ruleset=new GroupRules("AND"),$("#"+containerId).addClass("easy-query-maker"),$("#"+containerId).append(this.ruleset.getAllHTML(!0))}getFilters(){return read(this.ruleset)}getJson(){return this.ruleset.rules.map(rule=>{if(!0!==rule.DELETE){if(rule.rules)var obj=this.getJson();return{Column:rule.column,Operator:rule.operator,Value:rule.value}}})}}let initializePrototypes=function(){GroupRules.prototype.buttomAddRule=buttomMethods.AddRule,GroupRules.prototype.buttomAddGroup=buttomMethods.AddGroup,GroupRules.prototype.buttomDeleteGroup=buttomMethods.DeleteGroup,GroupRules.prototype.inputRadio=inputs.InputRadio,Rule.prototype.buttomDeleteRule=buttomMethods.DeleteRule,Rule.prototype.inputColumns=inputs.SelectColumns,Rule.prototype.inputOperators=inputs.SelectOperators,Rule.prototype.inputText=inputs.InputText};const DataType=function(){return{string:"string",boolean:"boolean",number:"number"}};let read=function(ruleset){return ruleset.rules.map(rule=>{if(!0===rule.DELETE)return;var stringValue;if(rule.rules)return"("+read(rule)+")";if(void 0===rule.column||void 0===rule.value||void 0===rule.operator)return;let columnObj=_fields.getById(rule.column),operatorObj=_operators.getById(rule.operator);var column=rule.column,operator=rule.operator,value=rule.value;let operatorProperties=[],dataTypeObj;if(null==operatorObj)throw"Error to get operator values";if(operatorProperties={operator_Name:operatorObj.name,operator_Value:operatorObj.value,operator_expression:operatorObj.expression},null!=columnObj&&(dataTypeObj=columnObj.dataType),null!=operatorProperties.operator_expression){let callBackReturn=operatorProperties.operator_expression(columnObj,operatorObj,value);return typeof callBackReturn==DataType().string?callBackReturn:""}return value=valueToSQL(rule.value,dataTypeObj),isDefined(column)&&isDefined(value)&&isDefined(operator)?"("+(column+" "+operator+" "+value).trim()+")":void 0}).filter(isDefined).join(" "+ruleset.condition+" ")},valueToSQL=function(value,dataType){switch(dataType){case"boolean":return value?"1":"0";case"number":if(isFinite(value))return value;default:return"'"+value+"'"}},isDefined=function(value){return void 0!==value},defaultData=[];defaultData.columns=function(){let list=new ColumnList;return list.setList([{name:"entity1",value:1,dataType:DataType().string},{name:"entity2",value:2,dataType:DataType().number},{name:"entity3",value:3,dataType:DataType().boolean}]),list.get()},defaultData.operators=function(){let operators=[{value:"=",name:"Equal"},{value:"<",name:"Less than"},{value:">",name:"Greater than"},{value:">=",name:"Greater than or equal to"},{value:"<=",name:"Less than or equal to"},{value:"<>",name:"Not equal to"},{value:"LIKE",name:"Like",expression:function(columnObj,operatorObj,inputValue){return columnObj.value+" "+operatorObj.value+" '%"+inputValue+"%'"}}],list=new OperatorList;return list.setList(operators),list.get()};let _fields=new ColumnList,_operators=new OperatorList;return{main:new Main,fields:_fields,operators:_operators}}));